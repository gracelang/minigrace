import "dictionaryTest" as dictionaryTestimport "scope" as scopeimport "gUnit" as gUimport "ast" as astdef markerSignature = [ ast.signaturePart.partName(nameDictionary.magicKey) ]def markerMethodNode = ast.methodNode.new(markerSignature, ast.nullNode, ast.unknownNode)def markerVar = scope.methodVariableFrom(markerMethodNode)def nameDictionary = scope.nameDictionary        class forMethod(m) {    inherit dictionaryTest.dictionaryTest.forMethod(m)        alias superSetup = setup    // Tests for nameDictionary.  It should pass all of the dictionary tests,     // but also additional tests for the special names like if(1)then(1)else(1).    var nonEmptyDict        method dictionaryUnderTestWith (bindings) {        nameDictionary.withAll (bindings)    }    method dictionaryUnderTestEmpty { nameDictionary.empty }    method dictionaryUnderTestFactory { nameDictionary }    method setup {        superSetup        nonEmptyDict := nameDictionary⟦String, Unknown⟧.withAll                    ["two"::2, "four"::4, "six"::6, "eight"::8,                     nameDictionary.magicKey::markerVar]    }    method testSetup {         self.assert (nonEmptyDict.containsKey "eight")               description "nonEmptyDict does not contain key \"eight\""         self.assert (nonEmptyDict.containsKey (nameDictionary.magicKey))               description "nonEmptyDict does not contain key \"{nameDictionary.magicKey}\""    }    method testMarkerVar {        self.assert (markerVar.isMethod)              description "{markerVar} does not represent a method"    }    method testTryCatchFinally {        def tcVariable = nonEmptyDict.at "try(1)catch(1)finally(1)"        self.assert (tcVariable.isSpecialControlStructure)             description "{tcVariable} is not a special control structure"    }    method testControlStructureRegEx_matches_try_catch_finally {        self.assert (nameDictionary.ctrlStructureRegEx.matches "try(1)catch(1)finally(1)")    }    method testControlStructureRegEx_matches_try_catch_catch {        self.assert (nameDictionary.ctrlStructureRegEx.matches "try(1)catch(1)catch(1)")    }    method testNameInsertedAfterLookup {        self.assert (nonEmptyDict.asString) shouldBe (            "dictionary [six::6, two::2, four::4, eight::8, " ++            "standardGraceExtendedControlStructures::meth standardGraceExtendedControlStructures]" )        self.assert (nonEmptyDict.at "match(1)case(1)case(1)".isMatchCase)        self.assert (nonEmptyDict.asString) shouldBe (            "dictionary [six::6, two::2, four::4, eight::8, " ++             "match(1)case(1)case(1)::ctrl match(1)case(1)case(1), " ++            "standardGraceExtendedControlStructures::meth standardGraceExtendedControlStructures]" )    }    method testMatchCaseCase {        self.assert (nonEmptyDict.at "match(1)case(1)case(1)".isSpecialControlStructure)        self.assert (nonEmptyDict.at "match(1)case(1)case(1)".isMatchCase)    }    method testTryCatch {        self.assert (nonEmptyDict.at "try(1)catch(1)".isSpecialControlStructure)        self.assert (nonEmptyDict.at "try(1)catch(1)".isTryCatch)    }    method testMatchCase {        self.assert (nonEmptyDict.at "match(1)case(1)".isSpecialControlStructure)        self.assert (nonEmptyDict.at "match(1)case(1)".isMatchCase)    }    method testIfThenElseIfThenElseIfThen {        self.assert (nonEmptyDict.at "if(1)then(1)elseif(1)then(1)elseif(1)then(1)".isSpecialControlStructure)        self.assert (nonEmptyDict.at "if(1)then(1)elseif(1)then(1)elseif(1)then(1)".isIfThenElse)    }    method testIfThenElseIfElse {        self.assert (nonEmptyDict.at "if(1)then(1)elseif(1)then(1)else(1)".isSpecialControlStructure)        self.assert (nonEmptyDict.at "if(1)then(1)elseif(1)then(1)else(1)".isIfThenElse)    }    method testIfThen {        self.assert (nonEmptyDict.at "if(1)then(1)".isSpecialControlStructure)        self.assert (nonEmptyDict.at "if(1)then(1)".isIfThenElse)    }    method testIfThenElse {        self.assert (nonEmptyDict.at "if(1)then(1)else(1)".isSpecialControlStructure)        self.assert (nonEmptyDict.at "if(1)then(1)else(1)".isIfThenElse)    }    method testTryCatchCatchFinally {        self.assert (nonEmptyDict.at "try(1)catch(1)catch(1)finally(1)".isSpecialControlStructure)        self.assert (nonEmptyDict.at "try(1)catch(1)catch(1)finally(1)".isTryCatch)    }}def nameDictTests = gU.testSuite.fromTestMethodsIn(self) named "name dictionary tests"nameDictTests.runAndPrintResults
